"use strict";!function(a){function b(b,c){this.$element=a(b),this.ratio=c}function c(){function c(c){a('[data-toggle="bt-ratio"]').each(function(){var c=a(this),d=c.data("bt-ratio"),e=parseFloat(c.attr("data-ratio"));return e?(d||c.data("bt-ratio",d=new b(this,e)),void d.resetHeight()):void console.error("data-ratio 系数未设置\n"+e)})}c(),a(window).resize(c)}b.prototype.resetHeight=function(){this.$element.css("height",this.$element.width()*this.ratio)},a.fn.Abox=c}(jQuery),function(a){function b(b,c){this.$element=a(b),this.loadComponent(),this.initProperty(c),this.addEvent()}function c(c){return this.each(function(){var d=a(this),e=d.data("bt.imgClip");e?e.addEvent():d.data("bt.imgClip",e=new b(this,c))})}b.defaults={width:100,height:100,handle:!0,top:0,left:0},b.prototype.initProperty=function(c){this.setting=a.extend(!0,b.defaults,c?c:{}),this.$origin.attr("src",this.setting.img),a(".bt-imgclip-chosen-img").attr("src",this.setting.img),this.$mask.width(this.setting.width),this.$mask.height(this.setting.height),this.setPosition(this.setting.top,this.setting.left),this.width=this.$mask.width(),this.height=this.$mask.height(),this.top=this.$mask[0].offsetTop,this.left=this.$mask[0].offsetLeft},b.prototype.loadComponent=function(){var b='<div class="bt-imgclip-mask"><div class="bt-imgclip-chosen"><img class="bt-imgclip-chosen-img"><div class="bt-chosen-border top"></div><div class="bt-chosen-border bottom"></div><div class="bt-chosen-border left"></div><div class="bt-chosen-border right"></div></div><div class="bt-imgclip-handle"><div class="bt-handle-border top"></div><div class="bt-handle-border bottom"></div><div class="bt-handle-border left"></div><div class="bt-handle-border right"></div><div class="bt-handle-box top-center"></div><div class="bt-handle-box top-left"></div><div class="bt-handle-box top-right"></div><div class="bt-handle-box bottom-center"></div><div class="bt-handle-box bottom-left"></div><div class="bt-handle-box bottom-right"></div><div class="bt-handle-box left-middle"></div><div class="bt-handle-box right-middle"></div></div></div>',c='<img class="bt-imgclip-origin">';this.$mask=a(b),this.$origin=a(c),this.$chosenImg=a(".bt-imgclip-chosen-img",this.$mask),this.$element.append(this.$mask),this.$element.append(this.$origin)},b.prototype.addEvent=function(){this.$mask.on("mousedown",a.proxy(this.startMove,this))},b.prototype.startMove=function(b){b.stopPropagation(),b.preventDefault(),this.clientX=b.clientX,this.clientY=b.clientY;var c=this.getHandleType(b.target.classList.toString());a(document).on("mousemove",{type:c},a.proxy(this.handleMoving,this)),a(document).one("mouseup",{type:c},a.proxy(this.handleMoveEnd,this))},b.prototype.setPosition=function(a,b){this.$mask.css({top:a+"px",left:b+"px"}),this.$chosenImg.css({top:-a+"px",left:-b+"px"})},b.prototype.handleMoving=function(a){a.stopPropagation(),a.preventDefault();var b=a.clientX-this.clientX,c=a.clientY-this.clientY;switch(console.log("dX,dY:("+b+","+c+")"),a.data.type){case 0:this.changeChosenPosition(b,c);break;case 1:this.changeBoxSize("Y",c,-1);break;case 2:this.changeBoxSize("Y",c,1);break;case 3:this.changeBoxSize("X",b,-1);break;case 4:this.changeBoxSize("X",b,1)}},b.prototype.handleMoveEnd=function(b){this.width=this.$mask.width(),this.height=this.$mask.height(),this.top=this.$mask[0].offsetTop,this.left=this.$mask[0].offsetLeft,a(document).off("mousemove",a.proxy(this.handleMoving,this))},b.prototype.changeChosenPosition=function(a,b){var c=this.top||0,d=this.left||0;console.log("top,left:"+(c+b)+","+(d+a)),this.isMoveOut(a,b,!1)||0>c+b||0>d+a||this.setPosition(c+b,d+a)},b.prototype.changeBoxSize=function(a,b,c){if(console.log("width,height:("+this.width+","+this.height+")"),"X"==a){var d=b*this.height/this.width;if(this.isMoveOut(b*c,d*c,0>c))return;this.$mask.width(this.width+b*c),this.$mask.height(this.height+d*c),0>c&&this.changeChosenPosition(b,d)}else if("Y"==a){var e=b*this.width/this.height;if(this.isMoveOut(e*c,b*c,0>c))return;this.$mask.width(this.width+e*c),this.$mask.height(this.height+b*c),0>c&&this.changeChosenPosition(e,b)}},b.prototype.isMoveOut=function(a,b,c){var d=a+this.width+this.left,e=b+this.height+this.top;if(console.log("width,height:"+d+","+e),d>this.$chosenImg.width()||0>d||e>this.$chosenImg.height()||0>e)return!0;if(c){var f=this.top-b,g=this.left-a;if(console.log("top,left:"+f+","+g),0>f||0>g)return!0}return!1},b.prototype.getHandleType=function(a){return/bt-imgclip-chosen-img/.test(a)?(console.log("chosen 移动"),0):/bt-handle-(border|box)\stop/.test(a)?(console.log("border 上移"),1):/bt-handle-(border|box)\sbottom/.test(a)?(console.log("border 下移"),2):/bt-handle-(border|box)\sleft/.test(a)?(console.log("border 左移"),3):/bt-handle-(border|box)\sright/.test(a)?(console.log("border 右移"),4):void 0},a.fn.ImgClip=c}(jQuery),function(a,b){function c(a){this.$element=a,this._init()}function d(){var b;this.each(function(){var c=a(this);b=c.data("bt-layer")}),b?b.setTarget(this):this.data("bt-layer",b=new c(this))}c.prototype._init=function(){this._saveOriginPosition(),this._addEvent()},c.prototype._saveOriginPosition=function(){this.$element.each(function(){var b=a(this),c=b.data("data-layer-origin-position-y");c||b.data("data-layer-origin-position-y",parseFloat(b.css("background-position-y"),10))})},c.prototype._addEvent=function(){a(b).bind("load",this._scrollHandler.bind(this)),a(b).bind("scroll",this._scrollHandler.bind(this)),a(b).bind("resize",this._scrollHandler.bind(this))},c.prototype._scrollHandler=function(c){var d=a(b).scrollTop(),e=a(b).height();this.$element.each(function(b){var c=a(this),f=c.offset();if(f.top+c.height()>d&&d+e>f.top){var g=parseFloat(c.attr("data-layer-position-ratio"),10),h=c.data("data-layer-origin-position-y");c.css("background-position-y",h+(d+e-f.top)*g),console.log(b+":--->"+(h+(d+e-f.top)*g))}})},c.prototype.setTarget=function(a){this.$element=a,this._saveOriginPosition()},c.prototype.dispose=function(){this.$element.data("bt-layer",null),this.$element=null,a(b).unbind("load",this._scrollHandler.bind(this)),a(b).unbind("scroll",this._scrollHandler.bind(this)),a(b).unbind("resize",this._scrollHandler.bind(this))},a.fn.layer=d}(jQuery,window),function(a){function b(c,d){this.setting=a.extend(b.defaults,d),this.$element=a(c),this.addEvent()}function c(c){return this.each(function(){var d=a(this),e=d.data("limit-words");e?e.addEvent():d.data("limit-words",e=new b(this,c))})}b.defaults={limitLength:200},b.prototype.addEvent=function(){this.$element.on("keyup",a.proxy(this.chargeWordsNumber,this));var b=this;this.$element.one("focusout",function(){b.$element.off("keyup",a.proxy(b.chargeWordsNumber,b))})},b.prototype.chargeWordsNumber=function(a){for(var b=this.$element.val(),c=0,d=b.length,e=0;d>c;c++)if(e+=b.charCodeAt(c)>255?2:1,e>this.setting.limitLength)return e-=b.charCodeAt(c)>255?2:1,this.$element.next(".bt-input-add>.js-number").text(e),this.$element.val(b.slice(0,c));return this.$element.next(".bt-input-add").children(".js-number").text(e)},a.fn.LimitWords=c,a(document).ready(function(){a(document).on("click",'[data-toggle="limit-words"]',function(b){var d=a(b.target),e=parseInt(d.attr("data-limit"));c.call(d,{limitLength:e})})})}(jQuery),function(a){function b(b,d){return this.each(function(){var e=a(this),f=e.data("bt.modal");f||e.data("bt.modal",f=new c(this,b)),"string"==typeof b?f[b](d):b.show&&f.show(d)})}var c=function(b,c){this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".bt-modal-dialog"),this.$backdrop=null,this.isShown=null};c.TRANSITION_DURATION=300,c.defualts={},c.prototype.show=function(b){var c=a.Event("show.bt.modal",{relatedTarget:b});if(this.$element.trigger(c),!this.isShown){this.isShown=!0;var d=this.measureScrollbar();this.$body.addClass("bt-modal-open"),this.hideScrollbar(d),this.backdrop(function(){})}},c.prototype.hide=function(a){this.$element.removeClass("in").off(".dismiss.bt.modal"),this.$backdrop.removeClass("in").off("dismiss.bt.modal"),this.isShown=!1,this.$element.hide(),this.$body.removeClass("bt-modal-open"),this.resetScrollbar(),this.removeBackdrop()},c.prototype.toggle=function(a){this.isShown?this.hide(a):this.show(a)},c.prototype.backdrop=function(b){var c=this;this.isShown&&(this.$backdrop=a(document.createElement("div")),this.$backdrop.addClass("bt-modal-backdrop fade").appendTo(this.$body),this.$element.on("click.dismiss.bt.modal",function(b){a(b.target).is(c.$element[0])&&c.hide()}),this.$backdrop.on("click",function(a){c.hide()}),this.$backdrop.addClass("in"),this.$element.show(0).addClass("in"))},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.hideScrollbar=function(a){this.originBodyPaddingRight=parseInt(this.$body.css("padding-right")||0,10),this.$body.css("padding-right",this.originBodyPaddingRight+a)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originBodyPaddingRight)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="bt-modal-measure-scrollbar",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b},a.fn.modal=b,a(document.body).on("click.bt.modal.auto-init",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bt.modal")?"toggle":a.extend({show:!0},f.data(),d.data());d.is("a")&&c.preventDefault(),b.call(f,g,this)})}(jQuery),function(a){function b(b){this.each(function(){var d=a(this),e=d.data("bt.slider");e||d.data("bt.slider",e=new c(this,b))})}var c=function(b,d){this.setting=a.extend(!0,c.defaults,d),this.$element=a(b),this.$content=a(".bt-content",this.$element),this.$page=a(".bt-page",this.$element),this.height=this.$element[0].clientHeight,this.width=this.$element[0].clientWidth,this.num=this.$page.length,this.index=0,this.initContent(),this.initNav();var e=window.navigator.userAgent.match(/MSIE\s(\d)/);e&&parseInt(e[1])<9&&(this.setting.ANIMATION=!1)};c.defaults={TRANSITION_DURATION:300,NAV:!0,ANIMATION:!0},c.prototype.initContent=function(){a(this.$page[0]).clone().appendTo(this.$content),a(this.$page[this.num-1]).clone().prependTo(this.$content),this.$page=a(".bt-page",this.$element),this.$page.css({width:this.width+"px"}),this.height||(this.height=this.$page[0].clientHeight),this.$element.css({height:this.height+"px"}),this.$page.css({height:this.height+"px"}),this.len=this.width*(this.num+2),this.$content.css({width:this.len+"px",left:-this.width+"px"})},c.prototype.initNav=function(){this.setting.NAV&&(this.$element.append('<div class="bt-slider-previous"></div><div class="bt-slider-next"></div>'),a(".bt-slider-next",this.$element).on("click",a.proxy(this.next,this)),a(".bt-slider-previous",this.$element).on("click",a.proxy(this.previous,this)))},c.prototype.next=function(b){if(!this.setting.ANIMATION)return void this.$content.append(a(".bt-page",this.$element)[0]);var c=this.$content[0].style.left.match(/-?\d+(?=px)/)[0],d=this;this.setLeft(parseInt(c)-d.width,d.setting.TRANSITION_DURATION,function(){d.index++,d.index==d.num&&(d.setLeft(-d.width,0),d.index=0)})},c.prototype.previous=function(b){if(!this.setting.ANIMATION)return void this.$content.prepend(a(".bt-page",this.$element)[this.num-1]);var c=this.$content[0].style.left.match(/-?\d+(?=px)/)[0],d=this;this.setLeft(parseInt(c)+d.width,d.setting.TRANSITION_DURATION,function(){d.index--,-1==d.index&&(d.setLeft(-d.width*d.num,0),d.index=d.num-1)})},c.prototype.setLeft=function(a,b,c){this.$content.animate({left:a+"px"},b,c)},a.fn.Slider=b}(jQuery);